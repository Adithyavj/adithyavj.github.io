<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Basic Authentication" /><meta name="author" content="Adithya Vijay" /><meta property="og:locale" content="en" /><meta name="description" content="Introduction In this blog, we’ll discuss about how we’ll store passwords in a database, the basics of authentication and jwt tokens. Authentication is verifying that the user is who he says he is. How to Store passwords in a database Password can be saved in different ways : Storing in clear text - Never save password in clear text Hashing the password - Apply a hashing algorithm to the password and storing the passwordhash in the database. You can’t calculate what the password is from the hash. However, if there are 2 people with the same password then the hashes of both these passwords will be the same. If the db is compromised, the hacker can identify that both passwords are same and decrypt them via the dictionary of hashes that have already been decrypted. Hashing and salting the password - A salt applied to a hashing algorithm will scramble the hash. So even if 2 passwords are the same, the password hash created will be different. We also have to store the password salt in the database to decode the hash (unscramble the hash). Simple basics authentication is implemented using password hash and salt. This is similar to the method followed in ASP.NET Identity however, it’s not as battle hardened as Identity. JWT Token Authentication An API is not something that we maintain a session state with. We make a request to an API, it returns the data we asked for and that ends the relationship with the API. Tokens are good to use with an API, they are small enough to send with each request. JWT is an industry standard for tokens. They are self contained and can contain credentials, claims, and other information. JWT has 3 parts each seperated by a ‘.’ period Header - It contains the algorithm and token type. The algorithm is used to encrypt the signature. The type of the token will be JWT Payload - It contains information like claims, credentials etc. - (Roles, name identifies). It has 3 timestamps notbefore(nbf), expairy(exp), issued at(iat) Signature - This signature is encrypted by the server using a private key. The only part of the token that is encrypted is the signature. We cannot modify the token and expect the API to accept it. This will change the entire structure of the token and signature won’t be verified. The header and payload part of a JWT token can be decoded here Working: A user logs in and sends their username and password to the server The server validates their credentials and returns a JWT token that the client will store locally on their machine. (We use browser storage to store the token) JWT stored in the local machine (browser storage) is send along with all further requests. Anytime we want to access something that is protected by authentiation on the server, we send the JWT token with the request. We add an authentication header to the request and then the server will verify that the token is valid. The server will have the private key that was used to encrypt the signature and can use this to verify that the token is valid (since it’s stored in the server user secrets, no need for a database call) Server verifies the JWT and sends back response. Benifits of JWT: No sessions to manage - JWT’s are self contained tokens. Portable - A single token can be used with multiple backends. (Backends all share same private key) No cookies required - mobile friendly (Mobile phones don’t have cookies) Performance - Once a token is issued, there is no need to make a database request to verify a users authentication To add JWT to .NET Core project use the package : System.IdentityModel.Tokens.Jwt by Microsoft Class to generate JWT Token 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 using System.IdentityModel.Tokens.Jwt; using System.Security.Claims; using System.Text; using API.Entities; using API.Interfaces; using Microsoft.IdentityModel.Tokens; public class TokenService : ITokenService { private readonly SymmetricSecurityKey _key; public TokenService(IConfiguration config) { _key = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(config[&quot;TokenKey&quot;])); // PrivateKey } public string CreateToken(AppUser user) { var claims = new List&lt;Claim&gt; { new Claim(JwtRegisteredClaimNames.NameId, user.UserName) }; var creds = new SigningCredentials(_key, SecurityAlgorithms.HmacSha512Signature); var tokenDescriptor = new SecurityTokenDescriptor { Subject = new ClaimsIdentity(claims), Expires = DateTime.Now.AddDays(7), SigningCredentials = creds }; var tokenHandler = new JwtSecurityTokenHandler(); var token = tokenHandler.CreateToken(tokenDescriptor); return tokenHandler.WriteToken(token); } } Authentication middleware in .NET 6 To add the authentication middleware, we need to first add the package Microsoft.AspNetCore.Authentication.JwtBearer by Microsoft Then we need to add the following in the configureservices() method in startup.cs 1 2 3 4 5 6 7 8 9 10 11 services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme) .AddJwtBearer(options =&gt; { options.TokenValidationParameters = new TokenValidationParameters { ValidateIssuerSigningKey = true, IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(_config[&quot;TokenKey&quot;])), ValidateIssuer = false, ValidateAudience = false }; }); After adding this, we need to add the useAuthorization() middleware after useAuthentication() in the configure method. To allow only authorized users to access an endpoint, we use the Authorize attribute on the particular method. Now to access the endpoint, we need to send the JWT token in the authorization header along with the request headers in the format Bearer &lt;jwtToken&gt;." /><meta property="og:description" content="Introduction In this blog, we’ll discuss about how we’ll store passwords in a database, the basics of authentication and jwt tokens. Authentication is verifying that the user is who he says he is. How to Store passwords in a database Password can be saved in different ways : Storing in clear text - Never save password in clear text Hashing the password - Apply a hashing algorithm to the password and storing the passwordhash in the database. You can’t calculate what the password is from the hash. However, if there are 2 people with the same password then the hashes of both these passwords will be the same. If the db is compromised, the hacker can identify that both passwords are same and decrypt them via the dictionary of hashes that have already been decrypted. Hashing and salting the password - A salt applied to a hashing algorithm will scramble the hash. So even if 2 passwords are the same, the password hash created will be different. We also have to store the password salt in the database to decode the hash (unscramble the hash). Simple basics authentication is implemented using password hash and salt. This is similar to the method followed in ASP.NET Identity however, it’s not as battle hardened as Identity. JWT Token Authentication An API is not something that we maintain a session state with. We make a request to an API, it returns the data we asked for and that ends the relationship with the API. Tokens are good to use with an API, they are small enough to send with each request. JWT is an industry standard for tokens. They are self contained and can contain credentials, claims, and other information. JWT has 3 parts each seperated by a ‘.’ period Header - It contains the algorithm and token type. The algorithm is used to encrypt the signature. The type of the token will be JWT Payload - It contains information like claims, credentials etc. - (Roles, name identifies). It has 3 timestamps notbefore(nbf), expairy(exp), issued at(iat) Signature - This signature is encrypted by the server using a private key. The only part of the token that is encrypted is the signature. We cannot modify the token and expect the API to accept it. This will change the entire structure of the token and signature won’t be verified. The header and payload part of a JWT token can be decoded here Working: A user logs in and sends their username and password to the server The server validates their credentials and returns a JWT token that the client will store locally on their machine. (We use browser storage to store the token) JWT stored in the local machine (browser storage) is send along with all further requests. Anytime we want to access something that is protected by authentiation on the server, we send the JWT token with the request. We add an authentication header to the request and then the server will verify that the token is valid. The server will have the private key that was used to encrypt the signature and can use this to verify that the token is valid (since it’s stored in the server user secrets, no need for a database call) Server verifies the JWT and sends back response. Benifits of JWT: No sessions to manage - JWT’s are self contained tokens. Portable - A single token can be used with multiple backends. (Backends all share same private key) No cookies required - mobile friendly (Mobile phones don’t have cookies) Performance - Once a token is issued, there is no need to make a database request to verify a users authentication To add JWT to .NET Core project use the package : System.IdentityModel.Tokens.Jwt by Microsoft Class to generate JWT Token 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 using System.IdentityModel.Tokens.Jwt; using System.Security.Claims; using System.Text; using API.Entities; using API.Interfaces; using Microsoft.IdentityModel.Tokens; public class TokenService : ITokenService { private readonly SymmetricSecurityKey _key; public TokenService(IConfiguration config) { _key = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(config[&quot;TokenKey&quot;])); // PrivateKey } public string CreateToken(AppUser user) { var claims = new List&lt;Claim&gt; { new Claim(JwtRegisteredClaimNames.NameId, user.UserName) }; var creds = new SigningCredentials(_key, SecurityAlgorithms.HmacSha512Signature); var tokenDescriptor = new SecurityTokenDescriptor { Subject = new ClaimsIdentity(claims), Expires = DateTime.Now.AddDays(7), SigningCredentials = creds }; var tokenHandler = new JwtSecurityTokenHandler(); var token = tokenHandler.CreateToken(tokenDescriptor); return tokenHandler.WriteToken(token); } } Authentication middleware in .NET 6 To add the authentication middleware, we need to first add the package Microsoft.AspNetCore.Authentication.JwtBearer by Microsoft Then we need to add the following in the configureservices() method in startup.cs 1 2 3 4 5 6 7 8 9 10 11 services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme) .AddJwtBearer(options =&gt; { options.TokenValidationParameters = new TokenValidationParameters { ValidateIssuerSigningKey = true, IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(_config[&quot;TokenKey&quot;])), ValidateIssuer = false, ValidateAudience = false }; }); After adding this, we need to add the useAuthorization() middleware after useAuthentication() in the configure method. To allow only authorized users to access an endpoint, we use the Authorize attribute on the particular method. Now to access the endpoint, we need to send the JWT token in the authorization header along with the request headers in the format Bearer &lt;jwtToken&gt;." /><link rel="canonical" href="https://blog.adithyavj.in/posts/basic-authentication/" /><meta property="og:url" content="https://blog.adithyavj.in/posts/basic-authentication/" /><meta property="og:site_name" content="Adithya Vijay" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-24T13:40:00+05:30" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Basic Authentication" /><meta name="twitter:site" content="@adithyavj" /><meta name="twitter:creator" content="@Adithya Vijay" /><meta name="google-site-verification" content="Sy5H9l1dxaEu6j-SufowIgZA9QHeroCNy4tt8GBXGlM" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Adithya Vijay"},"dateModified":"2022-05-25T15:03:33+05:30","datePublished":"2022-05-24T13:40:00+05:30","description":"Introduction In this blog, we’ll discuss about how we’ll store passwords in a database, the basics of authentication and jwt tokens. Authentication is verifying that the user is who he says he is. How to Store passwords in a database Password can be saved in different ways : Storing in clear text - Never save password in clear text Hashing the password - Apply a hashing algorithm to the password and storing the passwordhash in the database. You can’t calculate what the password is from the hash. However, if there are 2 people with the same password then the hashes of both these passwords will be the same. If the db is compromised, the hacker can identify that both passwords are same and decrypt them via the dictionary of hashes that have already been decrypted. Hashing and salting the password - A salt applied to a hashing algorithm will scramble the hash. So even if 2 passwords are the same, the password hash created will be different. We also have to store the password salt in the database to decode the hash (unscramble the hash). Simple basics authentication is implemented using password hash and salt. This is similar to the method followed in ASP.NET Identity however, it’s not as battle hardened as Identity. JWT Token Authentication An API is not something that we maintain a session state with. We make a request to an API, it returns the data we asked for and that ends the relationship with the API. Tokens are good to use with an API, they are small enough to send with each request. JWT is an industry standard for tokens. They are self contained and can contain credentials, claims, and other information. JWT has 3 parts each seperated by a ‘.’ period Header - It contains the algorithm and token type. The algorithm is used to encrypt the signature. The type of the token will be JWT Payload - It contains information like claims, credentials etc. - (Roles, name identifies). It has 3 timestamps notbefore(nbf), expairy(exp), issued at(iat) Signature - This signature is encrypted by the server using a private key. The only part of the token that is encrypted is the signature. We cannot modify the token and expect the API to accept it. This will change the entire structure of the token and signature won’t be verified. The header and payload part of a JWT token can be decoded here Working: A user logs in and sends their username and password to the server The server validates their credentials and returns a JWT token that the client will store locally on their machine. (We use browser storage to store the token) JWT stored in the local machine (browser storage) is send along with all further requests. Anytime we want to access something that is protected by authentiation on the server, we send the JWT token with the request. We add an authentication header to the request and then the server will verify that the token is valid. The server will have the private key that was used to encrypt the signature and can use this to verify that the token is valid (since it’s stored in the server user secrets, no need for a database call) Server verifies the JWT and sends back response. Benifits of JWT: No sessions to manage - JWT’s are self contained tokens. Portable - A single token can be used with multiple backends. (Backends all share same private key) No cookies required - mobile friendly (Mobile phones don’t have cookies) Performance - Once a token is issued, there is no need to make a database request to verify a users authentication To add JWT to .NET Core project use the package : System.IdentityModel.Tokens.Jwt by Microsoft Class to generate JWT Token 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 using System.IdentityModel.Tokens.Jwt; using System.Security.Claims; using System.Text; using API.Entities; using API.Interfaces; using Microsoft.IdentityModel.Tokens; public class TokenService : ITokenService { private readonly SymmetricSecurityKey _key; public TokenService(IConfiguration config) { _key = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(config[&quot;TokenKey&quot;])); // PrivateKey } public string CreateToken(AppUser user) { var claims = new List&lt;Claim&gt; { new Claim(JwtRegisteredClaimNames.NameId, user.UserName) }; var creds = new SigningCredentials(_key, SecurityAlgorithms.HmacSha512Signature); var tokenDescriptor = new SecurityTokenDescriptor { Subject = new ClaimsIdentity(claims), Expires = DateTime.Now.AddDays(7), SigningCredentials = creds }; var tokenHandler = new JwtSecurityTokenHandler(); var token = tokenHandler.CreateToken(tokenDescriptor); return tokenHandler.WriteToken(token); } } Authentication middleware in .NET 6 To add the authentication middleware, we need to first add the package Microsoft.AspNetCore.Authentication.JwtBearer by Microsoft Then we need to add the following in the configureservices() method in startup.cs 1 2 3 4 5 6 7 8 9 10 11 services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme) .AddJwtBearer(options =&gt; { options.TokenValidationParameters = new TokenValidationParameters { ValidateIssuerSigningKey = true, IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(_config[&quot;TokenKey&quot;])), ValidateIssuer = false, ValidateAudience = false }; }); After adding this, we need to add the useAuthorization() middleware after useAuthentication() in the configure method. To allow only authorized users to access an endpoint, we use the Authorize attribute on the particular method. Now to access the endpoint, we need to send the JWT token in the authorization header along with the request headers in the format Bearer &lt;jwtToken&gt;.","headline":"Basic Authentication","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.adithyavj.in/posts/basic-authentication/"},"url":"https://blog.adithyavj.in/posts/basic-authentication/"}</script><title>Basic Authentication | Adithya Vijay</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Adithya Vijay"><meta name="application-name" content="Adithya Vijay"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/images/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Adithya Vijay</a></div><div class="site-subtitle font-italic">Do the impossible</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/adithyavj" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/adithyavj" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['info','adithyavj.in'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Basic Authentication</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Basic Authentication</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/adithyavj">Adithya Vijay K</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-05-24 13:40:00 +0530" data-toggle="tooltip" data-placement="bottom" title="Tue, May 24, 2022, 1:40 PM +0530" >May 24</em> </span> <span> Updated <em class="timeago" date="2022-05-25 15:03:33 +0530 " data-toggle="tooltip" data-placement="bottom" title="Wed, May 25, 2022, 3:03 PM +0530" >May 25</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="882 words"> <em>4 min</em> read</span></div></div></div><div class="post-content"><h3 id="introduction">Introduction<a href="#introduction" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>In this blog, we’ll discuss about how we’ll store passwords in a database, the basics of authentication and jwt tokens. Authentication is verifying that the user is who he says he is.</p><h3 id="how-to-store-passwords-in-a-database">How to Store passwords in a database<a href="#how-to-store-passwords-in-a-database" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Password can be saved in different ways :</p><ul><li>Storing in clear text - Never save password in clear text<li>Hashing the password - Apply a hashing algorithm to the password and storing the passwordhash in the database. You can’t calculate what the password is from the hash. However, if there are 2 people with the same password then the hashes of both these passwords will be the same. If the db is compromised, the hacker can identify that both passwords are same and decrypt them via the dictionary of hashes that have already been decrypted.<li>Hashing and salting the password - A salt applied to a hashing algorithm will scramble the hash. So even if 2 passwords are the same, the password hash created will be different. We also have to store the password salt in the database to decode the hash (unscramble the hash). Simple basics authentication is implemented using password hash and salt. This is similar to the method followed in ASP.NET Identity however, it’s not as battle hardened as Identity.</ul><h3 id="jwt-token-authentication">JWT Token Authentication<a href="#jwt-token-authentication" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>An API is not something that we maintain a session state with. We make a request to an API, it returns the data we asked for and that ends the relationship with the API. Tokens are good to use with an API, they are small enough to send with each request. JWT is an industry standard for tokens. They are self contained and can contain credentials, claims, and other information. JWT has 3 parts each seperated by a ‘.’ period</p><ol><li>Header - It contains the algorithm and token type. The algorithm is used to encrypt the signature. The type of the token will be JWT<li>Payload - It contains information like claims, credentials etc. - (Roles, name identifies). It has 3 timestamps notbefore(nbf), expairy(exp), issued at(iat)<li>Signature - This signature is encrypted by the server using a private key. The only part of the token that is encrypted is the signature.</ol><p>We cannot modify the token and expect the API to accept it. This will change the entire structure of the token and signature won’t be verified. The header and payload part of a JWT token can be decoded <a href="https://jwt.io/">here</a></p><h4 id="working">Working:<a href="#working" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><ol><li>A user logs in and sends their username and password to the server<li>The server validates their credentials and returns a JWT token that the client will store locally on their machine. (We use browser storage to store the token)<li>JWT stored in the local machine (browser storage) is send along with all further requests.<li>Anytime we want to access something that is protected by authentiation on the server, we send the JWT token with the request.<li>We add an authentication header to the request and then the server will verify that the token is valid. The server will have the private key that was used to encrypt the signature and can use this to verify that the token is valid (since it’s stored in the server user secrets, no need for a database call)<li>Server verifies the JWT and sends back response.</ol><h4 id="benifits-of-jwt">Benifits of JWT:<a href="#benifits-of-jwt" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><ol><li>No sessions to manage - JWT’s are self contained tokens.<li>Portable - A single token can be used with multiple backends. (Backends all share same private key)<li>No cookies required - mobile friendly (Mobile phones don’t have cookies)<li>Performance - Once a token is issued, there is no need to make a database request to verify a users authentication</ol><p>To add JWT to .NET Core project use the package : System.IdentityModel.Tokens.Jwt by Microsoft</p><p>Class to generate JWT Token</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre>using System.IdentityModel.Tokens.Jwt;
using System.Security.Claims;
using System.Text;
using API.Entities;
using API.Interfaces;
using Microsoft.IdentityModel.Tokens;

public class TokenService : ITokenService
{
    private readonly SymmetricSecurityKey _key;

    public TokenService(IConfiguration config)
    {
        _key = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(config["TokenKey"])); // PrivateKey
    }

    public string CreateToken(AppUser user)
    {
        var claims = new List&lt;Claim&gt;
        {
            new Claim(JwtRegisteredClaimNames.NameId, user.UserName)
        };

        var creds = new SigningCredentials(_key, SecurityAlgorithms.HmacSha512Signature);

        var tokenDescriptor = new SecurityTokenDescriptor
        {
            Subject = new ClaimsIdentity(claims),
            Expires = DateTime.Now.AddDays(7),
            SigningCredentials = creds
        };

        var tokenHandler = new JwtSecurityTokenHandler();

        var token = tokenHandler.CreateToken(tokenDescriptor);

        return tokenHandler.WriteToken(token);
    }
}
</pre></table></code></div></div><h3 id="authentication-middleware-in-net-6">Authentication middleware in .NET 6<a href="#authentication-middleware-in-net-6" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>To add the authentication middleware, we need to first add the package Microsoft.AspNetCore.Authentication.JwtBearer by Microsoft Then we need to add the following in the configureservices() method in startup.cs</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
                .AddJwtBearer(options =&gt;
                {
                    options.TokenValidationParameters = new TokenValidationParameters
                    {
                        ValidateIssuerSigningKey = true,
                        IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(_config["TokenKey"])),
                        ValidateIssuer = false,
                        ValidateAudience = false
                    };
                });
</pre></table></code></div></div><p>After adding this, we need to add the useAuthorization() middleware after useAuthentication() in the configure method. To allow only authorized users to access an endpoint, we use the Authorize attribute on the particular method.</p><p>Now to access the endpoint, we need to send the JWT token in the authorization header along with the request headers in the format <code class="language-plaintext highlighter-rouge">Bearer &lt;jwtToken&gt;</code>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/programming/'>Programming</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/development-programming-dotnet6/" class="post-tag no-text-decoration" >development programming dotnet6</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Basic Authentication - Adithya Vijay&url=https://blog.adithyavj.in/posts/basic-authentication/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Basic Authentication - Adithya Vijay&u=https://blog.adithyavj.in/posts/basic-authentication/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Basic Authentication - Adithya Vijay&url=https://blog.adithyavj.in/posts/basic-authentication/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/stock-market/">Basics of Stock Market</a><li><a href="/posts/stock-market-crash-2008/">Stock Market Crash of 2008</a><li><a href="/posts/azure-fundamentals/">Microsoft Azure Fundamentals</a><li><a href="/posts/basic-authentication/">Basic Authentication</a><li><a href="/posts/angular-dotnet-app-part1/">Building the skeleton of an Angular 12 and .NET 6 Application - Part 1</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/development-programming-csharp/">development programming csharp</a> <a class="post-tag" href="/tags/development-programming-dotnet6-angular12/">development programming dotnet6 angular12</a> <a class="post-tag" href="/tags/stocks-investing-financial-wealth/">stocks investing financial wealth</a> <a class="post-tag" href="/tags/development-programming-cloud-azure-functions/">development programming cloud azure functions</a> <a class="post-tag" href="/tags/development-programming-cloud-azure/">development programming cloud azure</a> <a class="post-tag" href="/tags/development-programming-debugging-javascript/">development programming debugging javascript</a> <a class="post-tag" href="/tags/development-programming-dotnet6/">development programming dotnet6</a> <a class="post-tag" href="/tags/development-programming-dsa-c-dotnet6/">development programming dsa c# dotnet6</a> <a class="post-tag" href="/tags/development-programming-javascript-dom/">development programming javascript DOM</a> <a class="post-tag" href="/tags/development-programming-javascript/">development programming javascript</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/data-structures-and-algorithms/"><div class="card-body"> <em class="timeago small" date="2022-06-01 19:40:00 +0530" >Jun 1</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Data Structures and Algorithms in C#</h3><div class="text-muted small"><p> Introduction Abstract Data Type An abstract data type is a class. Data structures are classes that are storing data and acting on it. Classes contain representation of data and operation on data. ...</p></div></div></a></div><div class="card"> <a href="/posts/azure-fundamentals/"><div class="card-body"> <em class="timeago small" date="2022-06-16 14:10:00 +0530" >Jun 16</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Microsoft Azure Fundamentals</h3><div class="text-muted small"><p> Introduction This blog contains the concepts of Microsoft Azure Fundamentals required to take the AZ-900 certification exam. Cloud Concepts (20-25%) [MODULE - I] Cloud computing is the delivery...</p></div></div></a></div><div class="card"> <a href="/posts/azure-functions/"><div class="card-body"> <em class="timeago small" date="2022-10-14 16:10:00 +0530" >Oct 14</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Azure Functions</h3><div class="text-muted small"><p> Introduction Azure function is an easy way to build the applications you need using simple serverless functions that scale automatically based to meet demand. No need to worry about infrastructure ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/angular-dotnet-app-part2/" class="btn btn-outline-primary" prompt="Older"><p>Building the skeleton of an Angular 12 and .NET 6 Application - Part 2</p></a> <a href="/posts/data-structures-and-algorithms/" class="btn btn-outline-primary" prompt="Newer"><p>Data Structures and Algorithms in C#</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/adithyavj">Adithya Vijay K</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/development-programming-csharp/">development programming csharp</a> <a class="post-tag" href="/tags/development-programming-dotnet6-angular12/">development programming dotnet6 angular12</a> <a class="post-tag" href="/tags/stocks-investing-financial-wealth/">stocks investing financial wealth</a> <a class="post-tag" href="/tags/development-programming-cloud-azure-functions/">development programming cloud azure functions</a> <a class="post-tag" href="/tags/development-programming-cloud-azure/">development programming cloud azure</a> <a class="post-tag" href="/tags/development-programming-debugging-javascript/">development programming debugging javascript</a> <a class="post-tag" href="/tags/development-programming-dotnet6/">development programming dotnet6</a> <a class="post-tag" href="/tags/development-programming-dsa-c-dotnet6/">development programming dsa c# dotnet6</a> <a class="post-tag" href="/tags/development-programming-javascript-dom/">development programming javascript DOM</a> <a class="post-tag" href="/tags/development-programming-javascript/">development programming javascript</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-M4MPMMM5BV"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-M4MPMMM5BV'); }); </script>
